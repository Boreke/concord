---
import PostComponent from "../components/PostComponent.astro";
import Layout from "../layouts/Layout.astro";
import { postTemplate } from "../constants/postTemplate";
import EmptyPost from "../components/EmptyPost.astro";
import SearchSection from "../components/SearchSection.astro";
import { AuthService } from "../services/AuthService";
import { PostService } from "../services/PostService";
import { UserService } from "../services/UserService";
import { Post } from "../class/Post.ts";
var pageName = Astro.originPathname.split("/").pop();
pageName = !pageName ? "home" : pageName;
const pageTitle = pageName.charAt(0).toUpperCase() + pageName.slice(1);
const token = Astro.cookies.get("token")?.value;
const currentUser = await UserService.fetchCurrentUser(token!);
const posts: Post[] = AuthService.checkAuthServer(token)
  ? await PostService.fetchRecommendedPosts(currentUser?.id, token!)
  : await PostService.fetchPosts(token!);
---

<Layout>
  <main class="flex-1 border-x border-primary overflow-auto">
    <div
      class="flex items-center p-4 py-2 mt-3 border-b border-primary bg-white"
    >
      <h1 class="text-primary font-semibold text-lg">{pageTitle}</h1>
    </div>
    <EmptyPost />
    <div class="w-full bg-[#a79a0d]/90 h-3">&nbsp;</div>
    {
      posts && posts.length > 0 ? (
        posts.map((post) => <PostComponent post={post} />)
      ) : (
        <EmptyPost />
      )
    }
  </main>
  <SearchSection />
</Layout>
